language: swift
osx_image: xcode9.2
xcode_workspace: PlayerControls
cache: SnapshotTests

before_install:
- brew update
- brew install sourcery
- brew cask install fastlane
- bundle install
- cd SnapshotTests
- carthage update --platform iOS

script:
- cd ..
- fastlane test

after_failure:
- curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
- unzip awscli-bundle.zip
- sudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws
- aws configure set default.region eu-west-2
- aws configure set aws_access_key_id $ACCESS_KEY
- aws configure set aws_secret_access_key $SECRET_ACCESS_KEY
- aws s3 cp ./SnapshotTests/Tests/FailureDifferences s3://$S3_BUCKET/Failures/$TRAVIS_BRANCH/ --recursive --include "*.jpg" --exclude "*.DS_Store" --acl public-read
- aws s3api list-objects --bucket aol-public --query 'Contents[].Key'  | tee keys.json
- bundle exec danger --verbose